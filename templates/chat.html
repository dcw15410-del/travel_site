{% extends "base.html" %}
{% block title %}{{ room }} 채팅방{% endblock %}
{% block content %}
<h2>{{ room }} 채팅방</h2>
<div id="chat-box" class="border p-3 mb-3" style="height:300px; overflow-y:scroll;"></div>
<form id="chat-form" class="d-flex">
  <input id="msg" class="form-control me-2" placeholder="메시지 입력">
  <button class="btn btn-primary">전송</button>
</form>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
const socket = io();
const room = "{{ room }}";
const user = "{{ user.nickname }}";

socket.emit("join", {room, user});

socket.on("receive_message", data => {
  const box = document.getElementById("chat-box");
  box.innerHTML += `<div><b>${data.user}</b>: ${data.msg} <small>${data.time}</small></div>`;
  box.scrollTop = box.scrollHeight;
});

document.getElementById("chat-form").onsubmit = e => {
  e.preventDefault();
  const msg = document.getElementById("msg").value;
  if(msg.trim()){
    socket.emit("send_message", {room, user, msg});
    document.getElementById("msg").value = "";
  }
}
</script>
{% endblock %}

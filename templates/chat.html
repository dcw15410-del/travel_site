{% extends "base.html" %}
{% block content %}
<h2>{{ room }} 채팅방</h2>
<div id="chat-box" style="border:1px solid #ccc;height:300px;overflow-y:scroll;padding:10px;">
  {% for msg in messages %}
    <p><b>{{ msg.username }}:</b> {{ msg.content }}</p>
  {% endfor %}
</div>

<input id="msg" placeholder="메시지를 입력하세요" style="width:80%;">
<button onclick="sendMsg()">전송</button>

<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
<script>
const socket = io();
const username = "{{ username }}";
const room = "{{ room }}";

socket.emit("join", {username, room});

socket.on("receive_message", data => {
  document.getElementById("chat-box").innerHTML += `<p><b>${data.username}:</b> ${data.msg}</p>`;
});

socket.on("status", data => {
  document.getElementById("chat-box").innerHTML += `<p><i>${data.msg}</i></p>`;
});

function sendMsg() {
  const msg = document.getElementById("msg").value;
  if (msg.trim() === "") return;
  socket.emit("send_message", {username, room, msg});
  document.getElementById("msg").value = "";
}
</script>
{% endblock %}

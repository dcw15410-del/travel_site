{% extends "base.html" %}
{% block title %}채팅 - {{ room }}{% endblock %}
{% block content %}
<h1>{{ room }} 채팅방</h1>
<div id="messages" class="border p-3 mb-3" style="height:300px; overflow-y:scroll;">
    {% for msg in messages %}
        <div><strong>{{ msg.nickname }}:</strong> {{ msg.text }} <small>{{ msg.created_at.strftime("%H:%M:%S") }}</small></div>
    {% endfor %}
</div>
<input type="text" id="msgInput" class="form-control mb-2" placeholder="메시지를 입력하세요">
<button id="sendBtn" class="btn btn-primary">전송</button>

<script>
const socket = io();
const room = "{{ room }}";
const user = "{{ current_user.nickname if current_user else '익명' }}";

socket.emit('join', {room, user});

socket.on('receive_message', function(data){
    const messagesDiv = document.getElementById('messages');
    messagesDiv.innerHTML += `<div><strong>${data.user}:</strong> ${data.msg} <small>${data.time}</small></div>`;
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
});

document.getElementById('sendBtn').onclick = function(){
    const input = document.getElementById('msgInput');
    if(input.value.trim() !== ''){
        socket.emit('send_message', {room: room, msg: input.value});
        input.value = '';
    }
};
</script>
{% endblock %}

<!-- templates/currency.html -->
{% extends "base.html" %}
{% block title %}환율 계산기{% endblock %}
{% block content %}
  <h2>환율 계산기</h2>
  <form id="conv">
    <label>보낼 통화:
      <select name="from">
        {% for code,name in currencies.items() %}
          <option value="{{ code }}">{{ code }} - {{ name }}</option>
        {% endfor %}
      </select>
    </label>

    <label>받을 통화:
      <select name="to">
        {% for code,name in currencies.items() %}
          <option value="{{ code }}">{{ code }} - {{ name }}</option>
        {% endfor %}
      </select>
    </label>

    <label>금액: <input name="amount" value="1"></label>
    <button class="btn" type="submit">계산</button>
  </form>

  <div id="result" style="margin-top:12px;"></div>
{% endblock %}
{% block scripts %}
<script>
document.getElementById('conv').addEventListener('submit', async function(e){
  e.preventDefault();
  const f = new FormData(e.target);
  const from = f.get('from'), to = f.get('to'), amount = f.get('amount') || 1;
  const params = new URLSearchParams({from,to,amount});
  try{
    const res = await fetch('/convert_currency?' + params.toString());
    const j = await res.json();
    if (j.error) document.getElementById('result').textContent = '오류: ' + j.error;
    else {
      document.getElementById('result').textContent = `${amount} ${from} = ${j.result} ${to} (rate: ${j.rate})`;
    }
  }catch(err){
    document.getElementById('result').textContent = '서버 오류';
  }
});
</script>
{% endblock %}

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>{{ title if title else "여행 커뮤니티" }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
</head>
<body>
<header>
    <h1><a href="{{ url_for('index') }}">여행 커뮤니티</a></h1>
    <nav>
        <a href="{{ url_for('index') }}">홈</a>
        <a href="{{ url_for('chat_rooms') }}">채팅</a>
        {% if current_user %}
            <span>{{ current_user.nickname }}님</span>
            <a href="{{ url_for('logout') }}">로그아웃</a>
        {% else %}
            <a href="{{ url_for('login') }}">로그인</a>
            <a href="{{ url_for('register') }}">회원가입</a>
        {% endif %}
    </nav>
</header>

<main>
    {% block content %}{% endblock %}
</main>

<footer>
    <div id="live-time">
        {% for room, time in room_times.items() %}
            <span>{{ room }}: <b id="time-{{room}}">{{ time }}</b></span>
        {% endfor %}
    </div>
</footer>

<script>
const socket = io();

socket.on("time_update", data => {
    for (const [room, t] of Object.entries(data)) {
        const el = document.getElementById("time-" + room);
        if (el) el.textContent = t;
    }
});

socket.on("room_users_update", data => {
    for (const [room, count] of Object.entries(data.counts)) {
        const el = document.getElementById("count-" + room);
        if (el) el.textContent = count;
    }
});
</script>
</body>
</html>

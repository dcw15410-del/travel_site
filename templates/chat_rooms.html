<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>채팅방 목록</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
    <h2>채팅방 목록</h2>
    <ul id="room-list">
        {% for room in chat_rooms %}
        <li>
            <a href="{{ url_for('chat', room=room) }}">{{ room }}</a>
            <span>인원: <span id="count-{{ room }}">{{ room_users[room] }}</span>명</span>
            <span>시간: <span id="time-{{ room }}">{{ room_times[room] }}</span></span>
        </li>
        {% endfor %}
    </ul>

    <script>
        const socket = io();

        // 실시간 인원수 업데이트
        socket.on("room_users_update", function(data) {
            for (const room in data) {
                let el = document.getElementById("count-" + room);
                if (el) el.innerText = data[room];
            }
        });

        // 실시간 시각 갱신
        const timezones = {
            "한국": "Asia/Seoul",
            "일본": "Asia/Tokyo",
            "베트남": "Asia/Ho_Chi_Minh",
            "필리핀": "Asia/Manila",
            "태국": "Asia/Bangkok"
        };

        function updateTimes() {
            const now = new Date();
            for (const room in timezones) {
                try {
                    let tz = new Intl.DateTimeFormat("ko-KR", {
                        timeZone: timezones[room],
                        hour: "2-digit", minute: "2-digit", second: "2-digit"
                    }).format(now);
                    let el = document.getElementById("time-" + room);
                    if (el) el.innerText = tz;
                } catch(e) {
                    console.error("시간 변환 오류:", room, e);
                }
            }
        }
        setInterval(updateTimes, 1000);
        updateTimes();
    </script>
</body>
</html>

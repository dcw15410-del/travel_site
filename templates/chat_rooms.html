{% extends "base.html" %}
{% block title %}채팅방 목록{% endblock %}
{% block content %}
<h2>채팅방 목록</h2>
<div class="row">
  {% for room in chat_rooms %}
  <div class="col-md-4">
    <div class="card mb-3 shadow-sm">
      <div class="card-body">
        <h5 class="card-title">{{ room }}</h5>
        <p class="card-text">
          인원: <span id="count-{{ room }}">{{ room_users[room] }}</span>명<br>
          현지시각: <span id="time-{{ room }}">{{ room_times[room] }}</span>
        </p>
        <a href="{{ url_for('chat', room=room) }}" class="btn btn-primary">입장하기</a>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<script>
const socket = io();

// 서버에서 인원수 & 유저목록 갱신 브로드캐스트
socket.on("room_users_update", data => {
  const counts = data.counts || {};
  for (let room in counts) {
    const el = document.getElementById("count-" + room);
    if (el) el.textContent = counts[room];
  }
});

// 클라이언트에서 매초 현지시간 업데이트 (템플릿에서 내려받은 room_times 기반)
function updateTimes() {
  {% for room in chat_rooms %}
  let el = document.getElementById("time-{{ room }}");
  if (el) {
    // 그냥 클라이언트 현재시간으로 간단 표시
    const now = new Date();
    el.textContent = now.toLocaleTimeString("ko-KR", { hour12: false });
  }
  {% endfor %}
}
setInterval(updateTimes, 1000);
</script>
{% endblock %}
